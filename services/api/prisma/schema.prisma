// services/api/prisma/schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum KanbanStatus {
  PEDIDO
  COLA
  INICIO
  EN_PROCESO
  FINALIZADA
  FACTURADA
}

model Card {
  id                String        @id @default(uuid())
  titulo            String?
  descripcion       String?
  colorHex          String?
  status            KanbanStatus  @default(PEDIDO)
  fechaSolicitud    DateTime?
  solicitante       String?
  recibidoPor       String?
  fechaInicio       DateTime?
  duracionPrevista  Int?
  duracionReal      Int?
  fechaFinPropuesta DateTime?
  fechaFinReal      DateTime?
  responsableId     String?
  responsable       Responsable?   @relation(fields: [responsableId], references: [id])
  fechaFinPrevista  DateTime?
  diasAvanceReal    Int?
  diasRestantes     Int?
  importeAFacturar  Decimal?       @db.Decimal(12,2)
  importeFacturado  Decimal?       @db.Decimal(12,2)
  fechaFacturacion  DateTime?
  archivada         Boolean        @default(false)
  fechaArchivado    DateTime?
  asignaciones      CardAssignment[]
  createdAt         DateTime       @default(now())
  updatedAt         DateTime       @updatedAt
}

enum AssigneeType {
  RESPONSABLE
  PERSONAL
  RECURSO
}

model CardAssignment {
  id           String       @id @default(uuid())
  cardId       String
  card         Card         @relation(fields: [cardId], references: [id])
  assigneeType AssigneeType
  assigneeId   String
  activo       Boolean      @default(true)

  @@unique([cardId, assigneeType, assigneeId])
}

model Responsable {
  id        String   @id @default(uuid())
  nombre    String
  area      String?
  colorHex  String?
  fotoUrl   String?
  cards     Card[]
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Personal {
  id        String   @id @default(uuid())
  nombre    String
  especialidad String?
  colorHex  String?
  fotoUrl   String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Recurso {
  id        String   @id @default(uuid())
  nombre    String
  tipo      String?
  colorHex  String?
  fotoUrl   String?
  activo    Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
